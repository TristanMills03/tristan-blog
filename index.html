<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vitality AI | Human Performance OS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@300;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --brand-cyan: #06b6d4;
            --brand-blue: #3b82f6;
            --bg-dark: #020617;
            --card-bg: rgba(15, 23, 42, 0.6);
        }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--bg-dark); 
            background-image: radial-gradient(circle at 50% -20%, #1e293b 0%, #020617 80%);
            color: #f8fafc;
            overflow-x: hidden;
        }
        .heading-font { font-family: 'Space Grotesk', sans-serif; }
        .mono-font { font-family: 'JetBrains Mono', monospace; }
        
        .card-glass { 
            background: var(--card-bg); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }
        .card-glass:hover { border-color: rgba(6, 182, 212, 0.3); }
        
        .rank-none { fill: #1e293b; stroke: rgba(255,255,255,0.05); stroke-width: 1; }
        .rank-bronze { fill: #cd7f32; filter: drop-shadow(0 0 8px rgba(205, 127, 50, 0.4)); }
        .rank-silver { fill: #94a3b8; filter: drop-shadow(0 0 10px rgba(148, 163, 184, 0.4)); }
        .rank-gold { fill: #fbbf24; filter: drop-shadow(0 0 12px rgba(251, 191, 36, 0.5)); }
        .rank-platinum { fill: #22d3ee; filter: drop-shadow(0 0 15px rgba(34, 211, 238, 0.5)); }
        .rank-diamond { fill: #ffffff; filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.7)); }

        .progress-bar-bg { background: rgba(0,0,0,0.3); height: 6px; border-radius: 20px; position: relative; }
        .progress-bar-fill { height: 100%; border-radius: 20px; transition: width 1.2s cubic-bezier(0.34, 1.56, 0.64, 1); }
        
        .muscle-path { transition: all 1s ease; cursor: pointer; }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        
        @keyframes pulse-ring {
            0% { transform: scale(.33); opacity: 0; }
            80%, 100% { opacity: 0; }
        }
        .dot-pulse { position: relative; width: 8px; height: 8px; background: var(--brand-cyan); border-radius: 50%; }
        .dot-pulse::after { content: ''; position: absolute; top: -12px; left: -12px; width: 32px; height: 32px; border-radius: 50%; border: 2px solid var(--brand-cyan); animation: pulse-ring 2s infinite; }

        .grid-bg {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, rgba(255,255,255,0.02) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(255,255,255,0.02) 1px, transparent 1px);
        }
    </style>
</head>
<body class="grid-bg">

    <nav class="max-w-[1600px] mx-auto px-8 py-6 flex flex-wrap gap-6 items-center justify-between sticky top-0 z-[100] bg-slate-950/40 backdrop-blur-2xl border-b border-white/10">
        <div class="flex items-center gap-5">
            <div class="w-14 h-14 bg-gradient-to-tr from-cyan-600 to-blue-900 rounded-2xl flex items-center justify-center shadow-[0_0_30px_rgba(6,182,212,0.3)] border border-white/20">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
            </div>
            <div>
                <h1 class="heading-font text-3xl font-black tracking-tighter text-white">VITALITY <span class="text-cyan-400">AI</span></h1>
                <div class="flex items-center gap-3">
                    <div class="dot-pulse"></div>
                    <p class="mono-font text-[9px] text-cyan-500 font-bold uppercase tracking-[0.3em]">Neural System Active</p>
                </div>
            </div>
        </div>

        <div class="flex items-center gap-12">
            <div class="text-right">
                <p class="text-[9px] text-slate-500 font-black uppercase tracking-widest mb-1">Consistency</p>
                <p id="streakLabel" class="text-2xl font-black text-orange-500 italic">0 DAYS</p>
            </div>
            <div class="text-right border-l border-white/10 pl-12">
                <p class="text-[9px] text-slate-500 font-black uppercase tracking-widest mb-1">Overall Power</p>
                <div class="flex items-baseline gap-1">
                    <p id="totalLevel" class="text-4xl font-black text-white italic leading-none">0</p>
                    <span class="text-xs text-cyan-500 font-bold">LVL</span>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-[1600px] mx-auto px-8 grid grid-cols-1 lg:grid-cols-12 gap-8 py-8">
        
        <div class="lg:col-span-3 space-y-6">
            <!-- Nutrient Processor (Fixed) -->
            <div class="card-glass p-6 rounded-[2.5rem]">
                <h3 class="heading-font text-xs font-bold text-slate-400 uppercase tracking-[0.2em] mb-6">Nutrient Processor</h3>
                
                <div class="space-y-6">
                    <!-- Hydration -->
                    <div>
                        <div class="flex justify-between text-[10px] font-bold mb-1.5 uppercase">
                            <span class="text-cyan-400">Hydration</span>
                            <span id="waterText" class="text-white">0.0 / 3.5L</span>
                        </div>
                        <div class="progress-bar-bg"><div id="waterBar" class="progress-bar-fill bg-cyan-500 shadow-[0_0_15px_rgba(6,182,212,0.5)]" style="width: 0%"></div></div>
                        <div class="flex items-center gap-3 mt-4">
                            <div class="flex-1 flex flex-col gap-1">
                                <input type="range" id="waterSlider" min="0.1" max="1.5" step="0.1" value="0.5" 
                                       oninput="document.getElementById('waterPreview').innerText = this.value + 'L'" 
                                       class="w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer">
                                <span class="text-[9px] mono-font text-slate-500">Preview: <span id="waterPreview" class="text-cyan-400">0.5L</span></span>
                            </div>
                            <button onclick="logWater()" class="px-4 py-2 bg-cyan-500 text-slate-950 font-black text-[9px] rounded-lg hover:bg-white transition">ADD</button>
                        </div>
                    </div>

                    <div class="h-px bg-white/5"></div>

                    <!-- Calories -->
                    <div>
                        <div class="flex justify-between text-[10px] font-bold mb-1.5 uppercase">
                            <span class="text-orange-400">Energy Intake</span>
                            <span id="calText" class="text-white">0 / 2500 kcal</span>
                        </div>
                        <div class="progress-bar-bg"><div id="calBar" class="progress-bar-fill bg-orange-500" style="width: 0%"></div></div>
                        <div class="grid grid-cols-2 gap-2 mt-4">
                            <button onclick="logCalories(200)" class="p-2 bg-slate-900 border border-white/5 rounded-xl text-[9px] font-bold uppercase hover:border-orange-500">+200 kcal</button>
                            <button onclick="logCalories(500)" class="p-2 bg-slate-900 border border-white/5 rounded-xl text-[9px] font-bold uppercase hover:border-orange-500">+500 kcal</button>
                        </div>
                        <div class="relative mt-2">
                            <input type="number" id="customCal" placeholder="Custom..." class="w-full bg-slate-900 border border-white/5 rounded-xl px-3 py-2 text-[10px] mono-font focus:outline-none focus:border-orange-500">
                            <button onclick="logCalories(0)" class="absolute right-2 top-1.5 text-[10px] font-bold text-orange-400">ADD</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Training Command -->
            <div class="card-glass p-6 rounded-[2.5rem]">
                <h3 class="heading-font text-xs font-bold text-slate-400 uppercase tracking-[0.2em] mb-4">Training Calibration</h3>
                <div class="grid grid-cols-1 gap-2.5">
                    <button onclick="logWorkout('chest')" class="flex justify-between items-center p-4 bg-slate-900/80 border border-white/5 rounded-2xl text-[11px] font-black uppercase transition hover:border-cyan-500 group">
                        <span class="flex items-center gap-3"><span class="w-2 h-2 rounded-full bg-slate-700 group-hover:bg-cyan-500"></span>Chest</span>
                        <span class="mono-font text-cyan-500 text-[10px] opacity-40 group-hover:opacity-100">+5 XP</span>
                    </button>
                    <button onclick="logWorkout('back')" class="flex justify-between items-center p-4 bg-slate-900/80 border border-white/5 rounded-2xl text-[11px] font-black uppercase transition hover:border-cyan-500 group">
                        <span class="flex items-center gap-3"><span class="w-2 h-2 rounded-full bg-slate-700 group-hover:bg-cyan-500"></span>Back</span>
                        <span class="mono-font text-cyan-500 text-[10px] opacity-40 group-hover:opacity-100">+5 XP</span>
                    </button>
                    <button onclick="logWorkout('legs')" class="flex justify-between items-center p-4 bg-slate-900/80 border border-white/5 rounded-2xl text-[11px] font-black uppercase transition hover:border-cyan-500 group">
                        <span class="flex items-center gap-3"><span class="w-2 h-2 rounded-full bg-slate-700 group-hover:bg-cyan-500"></span>Legs</span>
                        <span class="mono-font text-cyan-500 text-[10px] opacity-40 group-hover:opacity-100">+5 XP</span>
                    </button>
                    <button onclick="logWorkout('arms')" class="flex justify-between items-center p-4 bg-slate-900/80 border border-white/5 rounded-2xl text-[11px] font-black uppercase transition hover:border-cyan-500 group">
                        <span class="flex items-center gap-3"><span class="w-2 h-2 rounded-full bg-slate-700 group-hover:bg-cyan-500"></span>Arms</span>
                        <span class="mono-font text-cyan-500 text-[10px] opacity-40 group-hover:opacity-100">+5 XP</span>
                    </button>
                    <button onclick="logWorkout('shoulders')" class="flex justify-between items-center p-4 bg-slate-900/80 border border-white/5 rounded-2xl text-[11px] font-black uppercase transition hover:border-cyan-500 group">
                        <span class="flex items-center gap-3"><span class="w-2 h-2 rounded-full bg-slate-700 group-hover:bg-cyan-500"></span>Shoulders</span>
                        <span class="mono-font text-cyan-500 text-[10px] opacity-40 group-hover:opacity-100">+5 XP</span>
                    </button>
                    <button onclick="logWorkout('core')" class="flex justify-between items-center p-4 bg-slate-900/80 border border-white/5 rounded-2xl text-[11px] font-black uppercase transition hover:border-cyan-500 group">
                        <span class="flex items-center gap-3"><span class="w-2 h-2 rounded-full bg-slate-700 group-hover:bg-cyan-500"></span>Core</span>
                        <span class="mono-font text-cyan-500 text-[10px] opacity-40 group-hover:opacity-100">+5 XP</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="lg:col-span-5 flex flex-col gap-6">
            <div class="card-glass p-10 rounded-[4rem] flex-grow flex flex-col items-center relative overflow-hidden">
                <div class="relative w-full max-w-[320px] flex-grow flex items-center">
                    <svg viewBox="0 0 200 450" class="w-full h-auto">
                        <path class="muscle-path rank-none" id="svg-core" d="M85,165 L115,165 L118,210 L82,210 Z M90,50 Q100,45 110,50 L115,100 L85,100 Z" />
                        <path class="muscle-path rank-none" id="svg-chest" d="M82,105 L118,105 L125,160 L75,160 Z" />
                        <path class="muscle-path rank-none" id="svg-shoulders" d="M70,105 Q60,105 60,120 L75,140 Z M130,105 Q140,105 140,120 L125,140 Z" />
                        <path class="muscle-path rank-none" id="svg-arms" d="M58,125 L45,210 L65,210 L72,145 Z M142,125 L155,210 L135,210 L128,145 Z" />
                        <path class="muscle-path rank-none" id="svg-legs" d="M80,215 L60,420 L98,420 L100,215 Z M120,215 L140,420 L102,420 L100,215 Z" />
                    </svg>
                </div>
                <div id="stat-container" class="w-full grid grid-cols-2 gap-x-12 gap-y-5 mt-10"></div>
            </div>
        </div>

        <div class="lg:col-span-4 space-y-6 flex flex-col">
            <div class="card-glass rounded-[3rem] flex-grow flex flex-col overflow-hidden border-cyan-500/20">
                <div class="p-6 border-b border-white/5 bg-slate-900/40 flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-4 h-4 bg-cyan-500 rounded-sm animate-pulse"></div>
                        <span class="heading-font text-sm font-bold tracking-widest text-white uppercase">Vitality AI</span>
                    </div>
                </div>
                
                <div id="chatWindow" class="flex-grow overflow-y-auto p-6 space-y-6 custom-scrollbar text-sm leading-relaxed">
                    <div class="bg-slate-900/60 p-5 rounded-3xl border border-white/5 text-[11px] mono-font text-cyan-400/70">
                        [SYSTEM]: BIO-LINK ESTABLISHED.<br>
                        [STATUS]: READY FOR INPUT.
                    </div>
                </div>

                <div class="p-6 bg-slate-950/60 backdrop-blur-3xl border-t border-white/10">
                    <div class="flex gap-3">
                        <input type="text" id="userInput" placeholder="ENTER COMMAND..." class="flex-1 bg-black/40 border border-white/10 rounded-2xl px-5 py-4 text-xs mono-font focus:outline-none focus:border-cyan-500">
                        <button onclick="sendMessage()" id="sendBtn" class="bg-cyan-600 text-white px-6 rounded-2xl hover:bg-cyan-400 hover:text-slate-950 transition">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="card-glass p-6 rounded-[2.5rem]">
                <h3 class="heading-font text-xs font-bold text-slate-500 uppercase tracking-widest mb-4">Activity Stream</h3>
                <div id="historyFeed" class="space-y-3 max-h-40 overflow-y-auto pr-2 custom-scrollbar"></div>
            </div>
        </div>
    </main>

    <script>
        const apiKey = ""; 
        const MUSCLES = ['chest', 'back', 'legs', 'arms', 'shoulders', 'core'];
        const RANK_LIMITS = [
            { name: 'INITIAL', min: 0, class: 'rank-none', color: '#1e293b' },
            { name: 'BRONZE', min: 25, class: 'rank-bronze', color: '#cd7f32' },
            { name: 'SILVER', min: 150, class: 'rank-silver', color: '#94a3b8' },
            { name: 'GOLD', min: 500, class: 'rank-gold', color: '#fbbf24' },
            { name: 'PLATINUM', min: 1500, class: 'rank-platinum', color: '#22d3ee' },
            { name: 'DIAMOND', min: 5000, class: 'rank-diamond', color: '#ffffff' }
        ];

        let state = {
            today: { date: new Date().toDateString(), water: 0, calories: 0, workouts: [] },
            persistent: {
                xp: { chest: 0, back: 0, legs: 0, arms: 0, shoulders: 0, core: 0 },
                streak: 0, lastActiveDate: null, history: []
            }
        };

        function init() {
            const saved = localStorage.getItem('vitality_final_v1');
            if (saved) state = JSON.parse(saved);
            checkDailyReset();
            updateUI();
            document.getElementById('userInput').addEventListener('keypress', (e) => { if(e.key === 'Enter') sendMessage(); });
        }

        function checkDailyReset() {
            const todayStr = new Date().toDateString();
            if (state.today.date !== todayStr) {
                state.persistent.history.push({ ...state.today });
                const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
                if (state.persistent.lastActiveDate !== yesterday.toDateString() && state.persistent.lastActiveDate !== todayStr) {
                    state.persistent.streak = 0;
                }
                state.today = { date: todayStr, water: 0, calories: 0, workouts: [] };
                save();
            }
        }

        function save() { localStorage.setItem('vitality_final_v1', JSON.stringify(state)); }

        function getRankInfo(xp) {
            let current = RANK_LIMITS[0];
            for (let r of RANK_LIMITS) if (xp >= r.min) current = r;
            const next = RANK_LIMITS[RANK_LIMITS.indexOf(current) + 1] || current;
            const progress = next.min === current.min ? 100 : ((xp - current.min) / (next.min - current.min)) * 100;
            return { ...current, progress };
        }

        function updateUI() {
            // Water UI
            document.getElementById('waterText').innerText = `${state.today.water.toFixed(1)} / 3.5L`;
            document.getElementById('waterBar').style.width = `${Math.min((state.today.water / 3.5) * 100, 100)}%`;
            
            // Calories UI
            document.getElementById('calText').innerText = `${state.today.calories} / 2500 kcal`;
            document.getElementById('calBar').style.width = `${Math.min((state.today.calories / 2500) * 100, 100)}%`;

            let totalPower = 0;
            const container = document.getElementById('stat-container');
            container.innerHTML = '';

            MUSCLES.forEach(m => {
                const xp = state.persistent.xp[m];
                const info = getRankInfo(xp);
                totalPower += Math.floor(xp / 5);
                const row = document.createElement('div');
                row.innerHTML = `
                    <div class="flex justify-between items-center mb-1.5 px-1">
                        <span class="text-[9px] font-black tracking-[0.2em] text-slate-500 uppercase">${m}</span>
                        <span class="mono-font text-[9px] font-bold" style="color:${info.color}">${info.name}</span>
                    </div>
                    <div class="progress-bar-bg"><div class="progress-bar-fill" style="width:${info.progress}%; background-color:${info.color}"></div></div>
                `;
                container.appendChild(row);
                const svg = document.getElementById(`svg-${m}`);
                if (svg) svg.setAttribute('class', `muscle-path ${info.class}`);
            });

            document.getElementById('totalLevel').innerText = totalPower;
            document.getElementById('streakLabel').innerText = `${state.persistent.streak} DAYS`;

            const feed = document.getElementById('historyFeed');
            feed.innerHTML = state.persistent.history.slice(-5).reverse().map(h => `
                <div class="flex items-center gap-4 p-3 bg-white/5 rounded-2xl border border-white/5 text-[10px]">
                    <span class="text-slate-600 font-bold">${h.date.slice(4,10)}</span>
                    <span class="text-cyan-400 font-black uppercase">${h.calories} KCAL | ${h.water}L</span>
                </div>
            `).join('');
        }

        window.logWater = () => {
            const val = parseFloat(document.getElementById('waterSlider').value);
            state.today.water = parseFloat((state.today.water + val).toFixed(2));
            save(); updateUI();
        };

        window.logCalories = (val) => {
            const input = document.getElementById('customCal');
            const finalVal = val > 0 ? val : parseInt(input.value) || 0;
            state.today.calories += finalVal;
            input.value = '';
            save(); updateUI();
        };

        window.logWorkout = (m) => {
            state.persistent.xp[m] += 5;
            state.today.workouts.push(m);
            if (state.persistent.lastActiveDate !== state.today.date) {
                state.persistent.streak++;
                state.persistent.lastActiveDate = state.today.date;
            }
            save(); updateUI();
        };

        async function sendMessage() {
            const inputEl = document.getElementById('userInput');
            const query = inputEl.value.trim();
            if (!query) return;
            appendMessage('user', query);
            inputEl.value = '';
            
            const systemPrompt = `You are Vitality AI Pro. Respond technically and concisely. User Data: Streak ${state.persistent.streak}, Calories ${state.today.calories}, Water ${state.today.water}L.`;
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: query }] }], systemInstruction: { parts: [{ text: systemPrompt }] } })
                });
                const data = await response.json();
                appendMessage('ai', data.candidates?.[0]?.content?.parts?.[0]?.text || "Communication error.");
            } catch (err) { appendMessage('ai', "Neural link unstable."); }
        }

        function appendMessage(role, text) {
            const win = document.getElementById('chatWindow');
            const msg = document.createElement('div');
            msg.className = role === 'user' ? 'bg-slate-800/50 ml-6 p-4 rounded-3xl border border-white/5 text-[11px]' : 'bg-cyan-900/10 mr-6 p-4 rounded-3xl border border-cyan-500/20 text-[11px]';
            msg.innerHTML = `<span class="opacity-40 block mb-1 uppercase font-black">${role==='user'?'> USER':'> AI'}</span>${text}`;
            win.appendChild(msg);
            win.scrollTop = win.scrollHeight;
        }

        window.onload = init;
    </script>
</body>
</html>
